<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2018-02-25 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180225" />
    <meta http-equiv="Content-Language" content="en" />
    <title>jkniv-whinstone-jdbc &#x2013; Configure JNDI Datasource</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
            <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
<meta name="keywords" content="whinstone, jdbc" />
      <!-- Google Analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-82389783-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="../whinstone/index.html" id="bannerLeft" title="whinstone"><img src="../images/logo.png"  alt="whinstone"/></a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2018-02-25<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.6.0.M16<span class="divider">|</span></li>
        <li class=""><a href="../index.html" title="jkniv">jkniv</a><span class="divider">»</span></li>
      <li class=""><a href="../jkniv-sqlegance/index.html" title="sqlegance">sqlegance</a><span class="divider">»</span></li>
      <li class=""><a href="../jkniv-camel-sap-jco3/index.html" title="camel-sap-jco3">camel-sap-jco3</a><span class="divider">»</span></li>
      <li class=""><a href="../jkniv-jaas-glassfish/index.html" title="jaas-glassfish">jaas-glassfish</a><span class="divider">»</span></li>
      <li class=""><a href="../jkniv-whinstone-jpa2/index.html" title="whinstone-jpa2">whinstone-jpa2</a><span class="divider">»</span></li>
    <li class="active ">Configure JNDI Datasource</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">jkniv-whinstone</li>
    <li><a href="../index.html" title="Introduction"><span class="none"></span>Introduction</a>  </li>
    <li><a href="../apidocs/whinstone/index.html" title="Javadoc"><span class="none"></span>Javadoc</a>  </li>
    <li><a href="https://sourceforge.net/projects/jkniv/files/whinstone-jpa2/" class="externalLink" title="Donwload"><span class="none"></span>Donwload</a>  </li>
          <li class="nav-header">whinstone jdbc</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>How-to Config Datasource</a>
  </li>
    <li><a href="transaction.html" title="Transaction"><span class="none"></span>Transaction</a>  </li>
    <li><a href="api-docs/index.html" title="Javadoc"><span class="none"></span>Javadoc</a>  </li>
    <li><a href="https://sourceforge.net/projects/jkniv/files/jkniv-whinstone/jdbc/" class="externalLink" title="Donwload"><span class="none"></span>Donwload</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="How-to_Configure_JNDI_Datasource"></a>How-to Configure JNDI Datasource</h2>
<p>This manual takes maven structure project as reference.</p>

<ol style="list-style-type: decimal">
  
<li>Edit <tt>WEB-INF/web.xml</tt> file.</li>
  
<li>Edit the resources file from your server, like <tt>WEB-INF/jetty-env.xml</tt> for jetty.</li>
  
<li>Create a file named <tt>repository-config.xml</tt> in <tt>src/main/resources</tt>, after compile or package the file go to <tt>WEB-INF/classes/repository-config.xml</tt> from web project, if your project isn&#x2019;t web must be root from classpath.</li>
</ol>
<h1>Jetty Server</h1>

<ol style="list-style-type: decimal">
  
<li>Contents <tt>web.xml</tt> file.</li>
</ol>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;resource-ref&gt;
  &lt;description&gt;Database DB2/AS400 Connection&lt;/description&gt;
  &lt;res-ref-name&gt;jdbc/as400&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
  &lt;res-auth&gt;Container&lt;/res-auth&gt; 
  &lt;mapped-name&gt;jdbc/as400&lt;/mapped-name&gt;
&lt;/resource-ref&gt;
</pre></div></div>

<ol style="list-style-type: decimal">
  
<li>Contents <tt>WEB-INF/jetty-env.xml</tt> file.</li>
</ol>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;!DOCTYPE Configure PUBLIC &quot;-//Mort Bay Consulting//DTD Configure//EN&quot; &quot;http://www.eclipse.org/jetty/configure.dtd&quot;&gt;
&lt;Configure class=&quot;org.eclipse.jetty.webapp.WebAppContext&quot;&gt;
  &lt;New id=&quot;dsAS400&quot; class=&quot;org.eclipse.jetty.plus.jndi.Resource&quot;&gt;
     &lt;Arg&gt;jdbc/as400&lt;/Arg&gt;
     &lt;Arg&gt;
       &lt;New class=&quot;com.jolbox.bonecp.BoneCPDataSource&quot;&gt;
         &lt;Set name=&quot;driverClass&quot;&gt;com.ibm.as400.access.AS400JDBCDriver&lt;/Set&gt;
         &lt;Set name=&quot;jdbcUrl&quot;&gt;jdbc:as400:192.168.0.10;&lt;/Set&gt;
         &lt;Set name=&quot;username&quot;&gt;my_user&lt;/Set&gt;
         &lt;Set name=&quot;password&quot;&gt;my_passwd&lt;/Set&gt;
         &lt;Set name=&quot;minConnectionsPerPartition&quot;&gt;4&lt;/Set&gt;
         &lt;Set name=&quot;maxConnectionsPerPartition&quot;&gt;10&lt;/Set&gt;
         &lt;Set name=&quot;acquireIncrement&quot;&gt;2&lt;/Set&gt;
         &lt;Set name=&quot;idleConnectionTestPeriod&quot;&gt;30&lt;/Set&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/New&gt;
&lt;/Configure&gt;
</pre></div></div>

<ol style="list-style-type: decimal">
  
<li>Contents <tt>repository-config.xml</tt> file.</li>
</ol>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;repository-config 
 xmlns=&quot;http://jkniv.sf.net/schema/sqlegance/config&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
 xsi:schemaLocation=&quot;http://jkniv.sf.net/schema/sqlegance/config 
 http://jkniv.sf.net/schema/sqlegance/sqlegance-config.xsd&quot;&gt;

&lt;repository name=&quot;commav&quot; type=&quot;JDBC&quot;&gt;
  &lt;jndi-data-source&gt;jdbc/as400&lt;/jndi-data-source&gt;
    &lt;properties&gt;
      &lt;property name=&quot;jkniv.repository.jdbc.dialect&quot; value=&quot;net.sf.jkniv.whinstone.jdbc.dialect.DB2Dialect&quot; /&gt;
    &lt;/properties&gt;
  &lt;/repository&gt;
&lt;/repository-config&gt;
</pre></div></div>
<p><i>Note:</i> See more details for <a class="externalLink" href="https://wiki.eclipse.org/Jetty/Howto/Configure_JNDI_Datasource" title="Configuring Datasoutce at Jetty">jetty-ds</a> and <a class="externalLink" href="https://wiki.eclipse.org/Jetty/Feature/JNDI" title="Enabling Jetty JNDI">jetty-jndi</a></p>
<h1>Tomcat Server (tested at 9 version)</h1>
<p><i>Notes:</i> Tomcat JNDI resource configuration changed somewhat between Tomcat 7.x and Tomcat 8.x as they are using different versions of Apache Commons DBCP library, see <a class="externalLink" href="https://tomcat.apache.org/tomcat-9.0-doc/jndi-datasource-examples-howto.html" title="Tomcat datasource sample">tomcat-change</a> and <a class="externalLink" href="http://tomcat.apache.org/migration.html" title="See Tomcat Migration Guide for details">tomcat-migration</a> for details </p>

<ol style="list-style-type: decimal">
  
<li>Contents <tt>web.xml</tt> file.</li>
</ol>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;resource-ref&gt;
  &lt;description&gt;Database DB2/AS400 Connection&lt;/description&gt;
  &lt;res-ref-name&gt;jdbc/as400&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
  &lt;res-auth&gt;Container&lt;/res-auth&gt; 
  &lt;mapped-name&gt;jdbc/as400&lt;/mapped-name&gt;
&lt;/resource-ref&gt;
</pre></div></div>

<ol style="list-style-type: decimal">
  
<li>Contents <tt>META-INF/context.xml</tt> file.</li>
</ol>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;Context path=&quot;/commav-rest&quot; reloadable=&quot;true&quot;&gt;    
  &lt;Resource name=&quot;jdbc/as400&quot; auth=&quot;Container&quot; type=&quot;javax.sql.DataSource&quot;
   maxActive=&quot;10&quot; maxIdle=&quot;30&quot; maxWaitMillis=&quot;10000&quot; driverClassName=&quot;com.ibm.as400.access.AS400JDBCDriver&quot;
   username=&quot;my_user&quot; password=&quot;my_passwd&quot; 
   url=&quot;jdbc:as400:192.168.0.10;&quot;/&gt;  
  &lt;ResourceLink name=&quot;jdbc/as400&quot; global=&quot;jdbc/as400&quot; type=&quot;javax.sql.DataSource&quot; /&gt;
&lt;/Context&gt;
</pre></div></div>

<ol style="list-style-type: decimal">
  
<li>Contents <tt>repository-config.xml</tt> file.</li>
</ol>
<p><i>Note</i>: The difference from jetty that tomcat needs the prefix <tt>java:comp/env/</tt> for jndi name in <tt>repository-config.xml</tt> file.</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;repository-config 
 xmlns=&quot;http://jkniv.sf.net/schema/sqlegance/config&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
 xsi:schemaLocation=&quot;http://jkniv.sf.net/schema/sqlegance/config 
 http://jkniv.sf.net/schema/sqlegance/sqlegance-config.xsd&quot;&gt;

  &lt;repository name=&quot;commav&quot; type=&quot;JDBC&quot;&gt;
    &lt;jndi-data-source&gt;java:comp/env/jdbc/as400&lt;/jndi-data-source&gt;
    &lt;properties&gt;
      &lt;property name=&quot;jkniv.repository.jdbc.dialect&quot; value=&quot;net.sf.jkniv.whinstone.jdbc.dialect.DB2Dialect&quot; /&gt;
    &lt;/properties&gt;
  &lt;/repository&gt;
&lt;/repository-config&gt;
</pre></div></div>
<h1>Glassfish Server</h1>
<h1>JBoss or Widlfy Server</h1>
<p>No tested.</p>
<h1>Weblogic Server</h1>
<p>No tested.</p>
<h1>WAS Server</h1>
<p>No tested.</p></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2012&#x2013;2018
<a href="http://jkniv.sourceforge.net/">jkniv</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
